@using MudBlazor
@inject ThemeService ThemeService

<MudMenu AnchorOrigin="@AnchorOrigin" TransformOrigin="@TransformOrigin" 
         Icon="@Icons.Material.Filled.Palette" 
         Label="@(ThemeService.CurrentTheme?.Name ?? "Select Theme")"
         Color="Color.Primary"
         Variant="Variant.Filled"
         Class="theme-picker-menu">
    <ChildContent>
        @if (EffectiveThemes != null && EffectiveThemes.Any())
        {
            @foreach (var theme in EffectiveThemes)
            {
                <MudMenuItem OnClick="@(() => SelectTheme(theme))" Class="theme-menu-item">
                    <div class="d-flex flex-column">
                        <MudText Typo="Typo.body1">@theme.Name</MudText>
                        @if (!string.IsNullOrEmpty(theme.Description))
                        {
                            <MudText Typo="Typo.caption" Color="Color.Secondary">@theme.Description</MudText>
                        }
                    </div>
                </MudMenuItem>
            }
        }
        else
        {
            <MudMenuItem Disabled="true">No themes available</MudMenuItem>
        }
    </ChildContent>
</MudMenu>

<style>
    .theme-picker-menu .mud-popover {
        min-width: 300px;
    }

    .theme-menu-item {
        min-width: 300px;
        white-space: normal;
    }
</style>

@code {
    /// <summary>
    /// Gets or sets the collection of available themes
    /// </summary>
    [Parameter]
    public IEnumerable<ThemeDefinition>? Themes { get; set; }

    /// <summary>
    /// Gets or sets the anchor origin point for the menu
    /// </summary>
    [Parameter]
    public Origin AnchorOrigin { get; set; } = Origin.BottomRight;

    /// <summary>
    /// Gets or sets the transform origin point for the menu
    /// </summary>
    [Parameter]
    public Origin TransformOrigin { get; set; } = Origin.TopRight;

    private IEnumerable<ThemeDefinition> EffectiveThemes => Themes ?? ThemeService.AvailableThemes ?? Enumerable.Empty<ThemeDefinition>();

    private void SelectTheme(ThemeDefinition theme)
    {
        ThemeService.SetTheme(theme);
    }
}
